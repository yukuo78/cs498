<html>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src='https://d3js.org/d3.v5.min.js'></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">

<style> circle {
    fill: lightblue;
    stroke: black;
} </style>
<body onload='init()'>
<div class="page-header">
    <h1>CS498 Project 2: <small>Narrative Visualization</small></h1>
</div>

<div class="row">
    <div class="col-sm-3">
        <div class="btn-toolbar" role="toolbar" aria-label="...">
            <div class="btn-group" role="group" aria-label="...">
                <p>
                <div class="btn btn-primary">1</div>
                <div class="btn btn-default">2</div>
                <div class="btn btn-default">3</div>
                </p>
            </div>
        </div>
    </div>
    <div id="div_template" class="col-md-6">
        <svg width=600 height=600>
        </svg>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>

<script>
    async function init() {
        // create a tooltip
        var Tooltip = d3.select("#div_template")
            .append("div")
            .style("opacity", 0)
            .attr("class", "tooltip")
            .style("width", "120px")
            .style("height", "80px")
            .style("background-color", "white")
            .style("border", "solid")
            .style("border-width", "2px")
            .style("border-radius", "5px")
            .style("padding", "5px");

        var mouseover = function (d) {
            Tooltip
                .style("opacity", 1)
            d3.select(this)
                .style("stroke", "green")
                .style("opacity", 1)
        };
        var mousemove = function (d) {
            Tooltip
                .html("The population of" + d.Country + "<br/> is: " + d.Population)
                .style("left", (d3.event.pageX) + "px")
                .style("top", (d3.event.pageY-100) + "px")
        };
        var mouseleave = function (d) {
            Tooltip
                .style("opacity", 0)
            d3.select(this)
                .style("stroke", "black")
                .style("opacity", 0.8)
        };
        var ys = d3.scaleLinear().domain([0, 0.08]).range([400, 0]);
        var xs = d3.scaleLog().domain([10, 100000]).range([0, 400]);
        var rs = d3.scaleLog().domain([30000, 1600000000]).range([1, 50]);

        data = await d3.csv("https://yukuo78.github.io/cs498/gdp_birth_pop_2012.csv");
        // data = await d3.csv("file:///Users/yukuo/Documents/homework/cs498/cs498/gdp_birth_pop.csv");

        d3.select("svg").append("g").attr("transform", "translate(50,50)")
            .selectAll("circle").data(data).enter().append("circle")
            .attr("cx", function (d) {
                return xs(d.Income);
                // return 100;
            })
            .attr("cy", function (d) {
                return ys(d.BirthRate);
                // return 10;
            })
            .attr("r", function (d) {
                return rs(Number(d.Population));
                // return 5;
            })
            .on("mouseover", mouseover)
            .on("mousemove", mousemove)
            .on("mouseleave", mouseleave)


        d3.select("svg").append("g").attr("transform", "translate(50,50)")
            .call(d3.axisLeft(ys).tickValues([0.01, 0.02, 0.05, 0.08]).tickFormat(d3.format("~s")))

        d3.select("svg").append("g").attr("transform", "translate(50,450)")
            .call(d3.axisBottom(xs).tickValues([10, 100, 1000, 10000, 100000]).tickFormat(d3.format("~s")))

    }
</script>
</body>
</html>
