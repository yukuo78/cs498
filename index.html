<html>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src='https://d3js.org/d3.v5.min.js'></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">

<style> circle {
    fill: lightblue;
    stroke: black;
} </style>
<body onload='init()'>
<div class="page-header">
    <h1>CS498 Project 2: <small>Narrative Visualization</small></h1>
</div>

<div class="row">
    <div class="col-sm-3">
        <div class="btn-toolbar" role="toolbar" aria-label="...">
            <div class="btn-group" role="group" aria-label="...">
                <p>
                <div class="btn btn-primary">1</div>
                <div class="btn btn-default">2</div>
                <div class="btn btn-default">3</div>
                </p>
            </div>
        </div>
    </div>
    <div id="div_template" class="col-md-6">
        <svg width=600 height=600>
        </svg>
    </div>
</div>
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>

<script>
    async function init() {
        // create a tooltip
        var Tooltip = d3.select("#div_template")
            .append("div")
            .style("opacity", 1)
            .attr("class", "tooltip")
            .style("width", "90px")
            .style("height", "60px")
            .style("background-color", "white")
            .style("border", "solid")
            .style("border-width", "2px")
            .style("border-radius", "5px")
            .style("padding", "5px");

        var mouseover = function (d) {
            Tooltip
                .style("opacity", 1)
            d3.select(this)
                .style("stroke", "green")
                .style("opacity", 1)
        };
        var mousemove = function (d) {
            Tooltip
                .html("The exact value of<br>this cell is: " + d.EngineCylinders)
                .style("left", (d3.event.pageX) + "px")
                .style("top", (d3.event.pageY-100) + "px")
        };
        var mouseleave = function (d) {
            Tooltip
                .style("opacity", 0)
            d3.select(this)
                .style("stroke", "black")
                .style("opacity", 0.8)
        };
        var ys = d3.scaleLog().domain([10, 150]).range([400, 0]);
        var xs = d3.scaleLog().domain([10, 150]).range([0, 400]);

        data = await d3.csv("https://flunky.github.io/cars2017.csv");

        d3.select("svg").append("g").attr("transform", "translate(50,50)")
            .selectAll("circle").data(data).enter().append("circle")
            .attr("cx", function (d) {
                return xs(d.AverageCityMPG);
            })
            .attr("cy", function (d) {
                return ys(d.AverageHighwayMPG);
            })
            .attr("r", function (d) {
                return 2 + Number(d.EngineCylinders);
            })
            .on("mouseover", mouseover)
            .on("mousemove", mousemove)
            .on("mouseleave", mouseleave)


        d3.select("svg").append("g").attr("transform", "translate(50,50)")
            .call(d3.axisLeft(ys).tickValues([10, 20, 50, 100]).tickFormat(d3.format("~s")))

        d3.select("svg").append("g").attr("transform", "translate(50,450)")
            .call(d3.axisBottom(xs).tickValues([10, 20, 50, 100]).tickFormat(d3.format("~s")))

    }
</script>
</body>
</html>
